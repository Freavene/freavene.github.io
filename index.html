<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sunshine Meal Planner ‚òÄÔ∏è</title>
    <!-- Police "Joviale" -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF9F1C; /* Mango Orange */
            --secondary: #2EC4B6; /* Tiffany Blue */
            --bg: #FFBF69; /* Soft Orange BG */
            --paper: #FFFFFF;
            --text: #2D3436;
            --danger: #FF6B6B;
            --success: #2CC990;
        }
        
        body { font-family: 'Poppins', sans-serif; background-color: #FFF4E6; margin: 0; padding: 0; color: var(--text); }
        
        /* HEADER JOYEUX */
        header { background: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(255, 159, 28, 0.15); position: sticky; top:0; z-index: 100; }
        h1 { margin: 0; font-size: 24px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        
        nav button { 
            background: transparent; border: none; color: #888; padding: 8px 18px; 
            cursor: pointer; margin-left: 5px; border-radius: 20px; font-weight: 600; transition: 0.3s; 
        }
        nav button.active { background: var(--primary); color: white; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(255, 159, 28, 0.4); }
        nav button:hover:not(.active) { color: var(--primary); background: #FFF4E6; }

        /* MAIN CONTENT */
        main { padding: 30px; max-width: 1300px; margin: 0 auto; }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

        /* CARDS & PANELS */
        .panel { background: var(--paper); padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #f0f0f0; }
        h2 { color: var(--secondary); margin-top: 0; font-size: 20px; display: flex; align-items: center; gap: 8px; }
        
        /* FORM ELEMENTS */
        label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 13px; color: #555; }
        input, select, textarea { 
            width: 100%; padding: 12px; border: 2px solid #EEE; border-radius: 12px; 
            box-sizing: border-box; font-family: 'Poppins'; font-size: 14px; transition: 0.3s; 
        }
        input:focus, select:focus { border-color: var(--secondary); outline: none; }
        
        .row { display: flex; gap: 20px; flex-wrap: wrap; }
        .col { flex: 1; min-width: 250px; }

        /* BUTTONS FUN */
        .btn { padding: 12px 24px; border: none; border-radius: 50px; cursor: pointer; font-weight: 600; color: white; transition: 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn:hover { transform: scale(1.02); }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--primary); box-shadow: 0 4px 15px rgba(255, 159, 28, 0.3); }
        .btn-success { background: var(--success); box-shadow: 0 4px 15px rgba(44, 201, 144, 0.3); }
        .btn-danger { background: var(--danger); box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3); }
        .btn-magic { background: linear-gradient(45deg, #FF9F1C, #FF6B6B); width: 100%; font-size: 16px; margin-bottom: 20px; }

        /* PLANNER GRID */
        .planner-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 15px; overflow-x: auto; padding-bottom: 10px; }
        .day-column { background: white; border-radius: 16px; min-width: 170px; border: 1px solid #eee; overflow: hidden; }
        .day-header { background: var(--secondary); color: white; padding: 12px; text-align: center; font-weight: bold; }
        
        .meal-slot { padding: 8px; border-bottom: 1px dashed #eee; min-height: 80px; position: relative; }
        .meal-type-label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #aaa; margin-bottom: 4px; display: block; }
        
        .planned-recipe { 
            background: #FFF8F0; padding: 8px; border-radius: 8px; border-left: 4px solid var(--primary); 
            font-size: 12px; cursor: pointer; transition: 0.2s; position: relative;
        }
        .planned-recipe:hover { transform: translateY(-2px); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .planned-recipe .macros-mini { font-size: 10px; color: #888; display: block; margin-top: 2px; }

        /* RECIPE CARDS */
        .recipe-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; }
        .recipe-card { background: white; border-radius: 16px; padding: 15px; border: 1px solid #eee; position: relative; transition: 0.2s; }
        .recipe-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); border-color: var(--primary); }
        .tag { padding: 4px 10px; font-size: 11px; border-radius: 20px; margin-right: 5px; display: inline-block; font-weight: 500; }
        .tag-Sweet { background: #FFE0E0; color: #FF6B6B; }
        .tag-Savory { background: #E0F7FA; color: #2EC4B6; }

        /* MACRO INPUTS */
        .macro-box { text-align: center; background: #F9F9F9; padding: 10px; border-radius: 12px; }
        .macro-box input { text-align: center; font-weight: bold; color: var(--primary); font-size: 18px; border: none; background: transparent; }

        /* PRINT */
        @media print {
            header, nav, .no-print, .btn { display: none !important; }
            body { background: white; }
            .planner-grid { display: grid !important; page-break-inside: avoid; }
        }
    </style>
</head>
<body>

<header>
    <h1>‚òÄÔ∏è Sunshine Planner</h1>
    <nav>
        <button onclick="showTab('settings')" class="no-print">‚öôÔ∏è Config</button>
        <button onclick="showTab('library')" class="no-print">üìö Recipes</button>
        <button onclick="showTab('planner')" class="active no-print">üìÖ Planner</button>
    </nav>
</header>

<main>

    <!-- TAB 1: SETTINGS -->
    <div id="settings" class="tab-content">
        <div class="row">
            <!-- Left: User Profile -->
            <div class="col">
                <div class="panel">
                    <h2>üë§ About You</h2>
                    
                    <label>Dietary Style</label>
                    <select id="setDiet">
                        <option value="Standard">Standard (No restriction)</option>
                        <option value="Vegetarian">Vegetarian ü•ö</option>
                        <option value="Vegan">Vegan üå±</option>
                        <option value="Pescatarian">Pescatarian üêü</option>
                        <option value="Gluten-Free">Gluten-Free üåæ</option>
                        <option value="Dairy-Free">Dairy-Free ü•õ</option>
                        <option value="Keto">Keto ü•ì</option>
                        <option value="Paleo">Paleo üçñ</option>
                        <option value="Low Carb">Low Carb</option>
                        <option value="High Protein">High Protein üí™</option>
                        <option value="Mediterranean">Mediterranean ü´í</option>
                    </select>

                    <div style="margin-top:15px; background:#FFF4E6; padding:15px; border-radius:12px;">
                        <label style="color:var(--danger)">‚õî Allergies (Strict Exclusion)</label>
                        <input type="text" id="setAllergies" placeholder="e.g. Peanuts, Shellfish (Comma separated)">
                        <small>Recipes containing these will be HIDDEN.</small>
                    </div>

                    <div style="margin-top:15px; background:#E0F7FA; padding:15px; border-radius:12px;">
                        <label style="color:var(--secondary)">ü§¢ Dislikes (Preference)</label>
                        <input type="text" id="setDislikes" placeholder="e.g. Mushrooms, Cilantro">
                        <small>Auto-generator will try to avoid these.</small>
                    </div>
                </div>

                <div class="panel">
                    <h2>üéØ Macro Targets</h2>
                    <label>Daily Calories Goal</label>
                    <input type="number" id="setCal" value="2000" style="font-size:20px; color:var(--primary); font-weight:bold;">
                    
                    <div class="row" style="margin-top:15px;">
                        <div class="col macro-box"><label>Protein</label><input type="number" id="setProt" value="150">g</div>
                        <div class="col macro-box"><label>Carbs</label><input type="number" id="setCarb" value="200">g</div>
                        <div class="col macro-box"><label>Fat</label><input type="number" id="setFat" value="70">g</div>
                    </div>
                </div>
            </div>

            <!-- Right: Meal Structure -->
            <div class="col">
                <div class="panel">
                    <h2>üçΩÔ∏è Meal Structure</h2>
                    <label>How many meals per day?</label>
                    <select id="setSlots" onchange="renderSlotConfig()">
                        <option value="3">3 Meals</option>
                        <option value="4">4 Meals (+ Snack)</option>
                        <option value="5">5 Meals (+ 2 Snacks)</option>
                        <option value="6">6 Meals</option>
                    </select>

                    <div id="slotConfigArea" style="margin-top:20px;">
                        <!-- JS will put dropdowns here for Sweet/Savory pref -->
                    </div>

                    <button class="btn btn-primary" onclick="saveSettings()" style="width:100%; margin-top:20px;">üíæ Save All Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB 2: LIBRARY -->
    <div id="library" class="tab-content">
        <div class="panel">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2>üìö Recipe Book</h2>
                <div style="font-size:12px; color:#888;">Add hardcoded recipes in the JS code below!</div>
            </div>
            
            <div class="row" style="margin-bottom:20px;">
                <input type="text" id="libSearch" placeholder="üîç Search recipes..." onkeyup="renderLibrary()">
                <select id="libFilter" onchange="renderLibrary()" style="max-width:200px;">
                    <option value="all">All Types</option>
                    <option value="Sweet">Sweet Only</option>
                    <option value="Savory">Savory Only</option>
                </select>
            </div>

            <div id="recipeGrid" class="recipe-grid"></div>
        </div>
    </div>

    <!-- TAB 3: PLANNER -->
    <div id="planner" class="tab-content active">
        
        <div class="row">
            <div class="col" style="flex:3">
                <div class="panel">
                    <div style="display:flex; justify-content:space-between;" class="no-print">
                        <h2>üìÖ Weekly Schedule</h2>
                        <div>
                            <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print</button>
                            <button class="btn btn-danger" onclick="clearPlanner()">üóëÔ∏è Clear</button>
                        </div>
                    </div>
                    
                    <button class="btn btn-magic no-print" onclick="autoGenerate()">‚ö° Auto-Fill My Week (Magic)</button>
                    
                    <div id="plannerGrid" class="planner-grid"></div>
                </div>
            </div>
            
            <div class="col no-print" style="flex:1">
                 <div class="panel">
                    <h2>üõí Shopping List</h2>
                    <div id="shoppingList" style="font-size:13px; line-height:1.6;"></div>
                </div>
                <div class="panel">
                    <h2>üìä Quick Stats</h2>
                    <div id="quickStats"></div>
                </div>
            </div>
        </div>

    </div>

</main>

<script>
    // ========================================================
    // ü•ë SECTION RECETTES (HARDCODED)
    // C'est ICI que tu ajoutes tes recettes manuellement !
    // Copie le bloc entre { ... } et colle-le apr√®s la virgule.
    // ========================================================
    const STARTER_RECIPES = [
        {
            id: 1,
            name: "Avocado Toast & Eggs",
            type: "Savory", // "Sweet" ou "Savory"
            diet: "Vegetarian", // Voir la liste des diets
            calories: 450,
            protein: 20,
            ingredients: ["Bread", "Avocado", "Eggs", "Chili flakes"]
        },
        {
            id: 2,
            name: "Oatmeal with Berries",
            type: "Sweet",
            diet: "Vegan",
            calories: 350,
            protein: 10,
            ingredients: ["Oats", "Almond Milk", "Blueberries", "Honey"]
        },
        {
            id: 3,
            name: "Grilled Chicken Salad",
            type: "Savory",
            diet: "High Protein",
            calories: 500,
            protein: 45,
            ingredients: ["Chicken Breast", "Lettuce", "Tomatoes", "Olive Oil"]
        },
        {
            id: 4,
            name: "Salmon & Quinoa Bowl",
            type: "Savory",
            diet: "Pescatarian",
            calories: 600,
            protein: 35,
            ingredients: ["Salmon", "Quinoa", "Cucumber", "Lemon"]
        },
        {
            id: 5,
            name: "Chocolate Protein Shake",
            type: "Sweet",
            diet: "High Protein",
            calories: 250,
            protein: 25,
            ingredients: ["Whey Protein", "Milk", "Banana", "Cocoa"]
        },
        {
            id: 6,
            name: "Tofu Stir Fry",
            type: "Savory",
            diet: "Vegan",
            calories: 400,
            protein: 18,
            ingredients: ["Tofu", "Broccoli", "Soy Sauce", "Rice"]
        },
        {
            id: 7,
            name: "Keto Bacon & Eggs",
            type: "Savory",
            diet: "Keto",
            calories: 550,
            protein: 30,
            ingredients: ["Eggs", "Bacon", "Butter"]
        }
    ];

    // ========================================================
    // ‚öôÔ∏è LOGIQUE DE L'APPLICATION
    // ========================================================

    const DAYS = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
    
    // Load data or use defaults
    let settings = JSON.parse(localStorage.getItem('sun_settings')) || {
        diet: 'Standard', allergies: '', dislikes: '',
        cal: 2000, prot: 150, slots: 3, slotPrefs: ['Savory', 'Savory', 'Savory']
    };
    
    // Merge hardcoded recipes with potential saved user recipes (if we add a builder later)
    let allRecipes = [...STARTER_RECIPES]; 
    let weeklyPlan = JSON.parse(localStorage.getItem('sun_plan')) || {};

    function init() {
        // Load Settings into Inputs
        document.getElementById('setDiet').value = settings.diet;
        document.getElementById('setAllergies').value = settings.allergies;
        document.getElementById('setDislikes').value = settings.dislikes;
        document.getElementById('setCal').value = settings.cal;
        document.getElementById('setProt').value = settings.prot;
        document.getElementById('setSlots').value = settings.slots;
        
        renderSlotConfig();
        renderLibrary();
        renderPlanner();
        updateStats();
    }

    function showTab(id) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelector(`button[onclick="showTab('${id}')"]`).classList.add('active');
    }

    // --- SETTINGS LOGIC ---
    function renderSlotConfig() {
        const count = parseInt(document.getElementById('setSlots').value);
        const area = document.getElementById('slotConfigArea');
        area.innerHTML = '<h4>Taste Preference per Meal</h4>';
        
        for(let i=0; i<count; i++) {
            const currentPref = settings.slotPrefs[i] || 'Any';
            area.innerHTML += `
                <div style="margin-bottom:10px; display:flex; gap:10px; align-items:center;">
                    <span style="font-size:12px; font-weight:bold; width:60px;">Meal ${i+1}</span>
                    <select id="pref_${i}" style="padding:5px;">
                        <option value="Any" ${currentPref=='Any'?'selected':''}>Any Style</option>
                        <option value="Sweet" ${currentPref=='Sweet'?'selected':''}>Sweet ü•û</option>
                        <option value="Savory" ${currentPref=='Savory'?'selected':''}>Savory ü•ó</option>
                    </select>
                </div>
            `;
        }
    }

    function saveSettings() {
        const count = parseInt(document.getElementById('setSlots').value);
        let newPrefs = [];
        for(let i=0; i<count; i++) {
            newPrefs.push(document.getElementById(`pref_${i}`).value);
        }

        settings = {
            diet: document.getElementById('setDiet').value,
            allergies: document.getElementById('setAllergies').value,
            dislikes: document.getElementById('setDislikes').value,
            cal: parseFloat(document.getElementById('setCal').value),
            prot: parseFloat(document.getElementById('setProt').value),
            slots: count,
            slotPrefs: newPrefs
        };
        localStorage.setItem('sun_settings', JSON.stringify(settings));
        renderPlanner(); // Refresh grid layout
        alert("Settings Saved! ‚òÄÔ∏è");
    }

    // --- LIBRARY LOGIC ---
    function renderLibrary() {
        const grid = document.getElementById('recipeGrid');
        const search = document.getElementById('libSearch').value.toLowerCase();
        const typeFilter = document.getElementById('libFilter').value;
        const allergies = settings.allergies.toLowerCase().split(',').map(s=>s.trim()).filter(s=>s);

        grid.innerHTML = '';

        allRecipes.forEach(r => {
            // Filters
            if(search && !r.name.toLowerCase().includes(search)) return;
            if(typeFilter !== 'all' && r.type !== typeFilter) return;

            // Allergy Hiding
            const hasAllergy = r.ingredients.some(ing => 
                allergies.some(bad => ing.toLowerCase().includes(bad))
            );
            if(hasAllergy) return;

            const tagColor = r.type === 'Sweet' ? 'tag-Sweet' : 'tag-Savory';

            grid.innerHTML += `
                <div class="recipe-card">
                    <h3>${r.name}</h3>
                    <div style="margin-bottom:8px;">
                        <span class="tag ${tagColor}">${r.type}</span>
                        <span class="tag" style="background:#eee">${r.diet}</span>
                    </div>
                    <div style="font-size:12px; color:#666;">
                        üî• ${r.calories} kcal &bull; ü•© ${r.protein}g prot
                    </div>
                    <div style="font-size:11px; color:#999; margin-top:5px; font-style:italic;">
                        ${r.ingredients.join(', ')}
                    </div>
                </div>
            `;
        });
    }

    // --- PLANNER LOGIC ---
    function renderPlanner() {
        const grid = document.getElementById('plannerGrid');
        grid.innerHTML = '';

        DAYS.forEach(day => {
            let colHTML = `<div class="day-column"><div class="day-header">${day}</div>`;
            
            for(let i=0; i<settings.slots; i++) {
                const key = `${day}-${i}`;
                const rid = weeklyPlan[key];
                const pref = settings.slotPrefs[i] || 'Any';
                
                let slotContent = '';
                if(rid) {
                    const r = allRecipes.find(x => x.id === rid);
                    if(r) {
                        slotContent = `
                            <div class="planned-recipe">
                                <span style="position:absolute; top:2px; right:4px; color:red; font-weight:bold; cursor:pointer;" onclick="removeMeal('${key}')">&times;</span>
                                <strong>${r.name}</strong>
                                <span class="macros-mini">${r.calories} kcal</span>
                            </div>
                        `;
                    }
                }

                colHTML += `
                    <div class="meal-slot">
                        <span class="meal-type-label">Meal ${i+1} (${pref})</span>
                        ${slotContent}
                    </div>
                `;
            }
            colHTML += `</div>`;
            grid.innerHTML += colHTML;
        });
        updateStats();
    }

    function removeMeal(key) {
        delete weeklyPlan[key];
        localStorage.setItem('sun_plan', JSON.stringify(weeklyPlan));
        renderPlanner();
    }

    function clearPlanner() {
        if(confirm("Clear the whole week?")) {
            weeklyPlan = {};
            localStorage.setItem('sun_plan', JSON.stringify(weeklyPlan));
            renderPlanner();
        }
    }

    // --- MAGIC AUTO GENERATOR ‚ö° ---
    function autoGenerate() {
        const dislikes = settings.dislikes.toLowerCase().split(',').map(s=>s.trim()).filter(s=>s);
        const allergies = settings.allergies.toLowerCase().split(',').map(s=>s.trim()).filter(s=>s);
        
        let availableRecipes = allRecipes.filter(r => {
            // 1. Check Diet
            if(settings.diet !== 'Standard') {
                if(r.diet !== settings.diet && r.diet !== 'Vegan' && r.diet !== 'Vegetarian') return false; 
                // (Assuming strict filtering, simplified for demo)
            }
            // 2. Check Allergies (Strict)
            const hasAllergy = r.ingredients.some(ing => allergies.some(bad => ing.toLowerCase().includes(bad)));
            if(hasAllergy) return false;
            
            return true;
        });

        if(availableRecipes.length === 0) {
            alert("No recipes match your Diet/Allergy criteria! Add more recipes.");
            return;
        }

        DAYS.forEach(day => {
            for(let i=0; i<settings.slots; i++) {
                const key = `${day}-${i}`;
                if(weeklyPlan[key]) continue; // Don't overwrite manually added meals

                const pref = settings.slotPrefs[i] || 'Any';
                
                // Filter by Slot Preference (Sweet/Savory)
                let candidates = availableRecipes.filter(r => pref === 'Any' || r.type === pref);
                
                // Try to filter Dislikes (Soft filter)
                let lovedCandidates = candidates.filter(r => !r.ingredients.some(ing => dislikes.some(bad => ing.toLowerCase().includes(bad))));
                
                // If we have "loved" ones, use them, otherwise use any valid candidates
                let pool = lovedCandidates.length > 0 ? lovedCandidates : candidates;

                if(pool.length > 0) {
                    const randomRec = pool[Math.floor(Math.random() * pool.length)];
                    weeklyPlan[key] = randomRec.id;
                }
            }
        });

        localStorage.setItem('sun_plan', JSON.stringify(weeklyPlan));
        renderPlanner();
        alert("‚ú® Magic Complete! Your week is planned.");
    }

    // --- STATS & SHOPPING ---
    function updateStats() {
        const shopDiv = document.getElementById('shoppingList');
        const statsDiv = document.getElementById('quickStats');
        let ingredientsMap = {};
        let totalCal = 0;
        let filledSlots = 0;

        for(let key in weeklyPlan) {
            const r = allRecipes.find(x => x.id === weeklyPlan[key]);
            if(r) {
                totalCal += r.calories;
                filledSlots++;
                r.ingredients.forEach(ing => {
                    ingredientsMap[ing] = (ingredientsMap[ing] || 0) + 1;
                });
            }
        }

        // Shopping List HTML
        if(Object.keys(ingredientsMap).length === 0) {
            shopDiv.innerHTML = '<p style="color:#aaa">Plan meals to see items.</p>';
        } else {
            let html = '<ul style="padding-left:20px; margin:0;">';
            for(let [ing, count] of Object.entries(ingredientsMap)) {
                html += `<li>${ing} ${count > 1 ? `(x${count})` : ''}</li>`;
            }
            html += '</ul>';
            shopDiv.innerHTML = html;
        }

        // Stats HTML
        const dailyAvg = filledSlots > 0 ? Math.round(totalCal / 7) : 0; // Rough avg over 7 days
        statsDiv.innerHTML = `
            <div style="margin-bottom:10px;">
                <strong>Avg Calories:</strong> ${dailyAvg} / ${settings.cal}
            </div>
            <div style="background:#eee; height:10px; border-radius:5px; overflow:hidden;">
                <div style="background:var(--primary); width:${Math.min((dailyAvg/settings.cal)*100, 100)}%; height:100%;"></div>
            </div>
        `;
    }

    init();

</script>
</body>
</html>
