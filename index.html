<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>USDA Meal Planner</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f5f7fa; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        h1 { text-align: center; color: #005a87; } /* USDA Blue */

        /* SEARCH SECTION */
        .search-box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        button { background: #005a87; color: white; border: none; padding: 12px 20px; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #004466; }

        /* SEARCH RESULTS (The List) */
        #searchResults { margin-top: 10px; display: none; background: white; border: 1px solid #ddd; max-height: 200px; overflow-y: auto; border-radius: 4px; }
        .result-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .result-item:hover { background-color: #eef7ff; }

        /* TABLE */
        .table-container { margin-top: 30px; overflow-x: auto; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; min-width: 1200px; }
        th { background: #005a87; color: white; padding: 12px; text-align: left; font-size: 14px; }
        td { padding: 10px; border-bottom: 1px solid #eee; font-size: 14px; }
        
        .totals { background: #333; color: white; font-weight: bold; }
        .totals td { border: none; }

        .loading { text-align: center; margin: 10px; font-style: italic; color: #666; display: none; }
        .delete-btn { color: red; background: none; border: none; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸ‡ºðŸ‡¸ USDA Nutrient Tracker</h1>
    
    <!-- SEARCH -->
    <div class="search-box">
        <input type="text" id="query" placeholder="Search USDA Database (e.g. Raw Spinach)">
        <button onclick="searchFood()">Search</button>
    </div>
    
    <div id="loading" class="loading">Searching USDA Database...</div>
    
    <!-- RESULT LIST (Hidden by default) -->
    <div id="searchResults"></div>

    <!-- TABLE -->
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Food Name</th>
                    <th>Weight</th>
                    <th>Kcal</th>
                    <th>Protein</th>
                    <th>Carbs</th>
                    <th>Fat</th>
                    <th>Calcium</th>
                    <th>Iron</th>
                    <th>Vit C</th>
                    <th>Magnesium</th>
                    <th>Potassium</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="mealList"></tbody>
            <tfoot>
                <tr class="totals">
                    <td>TOTAL</td>
                    <td id="tWeight">0g</td>
                    <td id="tCal">0</td>
                    <td id="tProt">0g</td>
                    <td id="tCarb">0g</td>
                    <td id="tFat">0g</td>
                    <td id="tCalci">0mg</td>
                    <td id="tIron">0mg</td>
                    <td id="tVitC">0mg</td>
                    <td id="tMag">0mg</td>
                    <td id="tPot">0mg</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<script>
    // ==========================================
    // TA CLÃ‰ EST DÃ‰JÃ€ CONFIGURÃ‰E ICI :
    // ==========================================
    const API_KEY = 'nBfP2kXAaG0bmdHElfBcNiWeWbdB5vdtzzoZ80se';
    
    let mealPlan = [];

    // 1. SEARCH FUNCTION
    async function searchFood() {
        const query = document.getElementById('query').value;
        const resultsDiv = document.getElementById('searchResults');
        const loader = document.getElementById('loading');

        if(!query) return;

        loader.style.display = 'block';
        resultsDiv.style.display = 'none';

        // USDA Search Endpoint
        const url = `https://api.nal.usda.gov/fdc/v1/foods/search?api_key=${API_KEY}&query=${query}&dataType=Foundation,SR Legacy&pageSize=10`;

        try {
            const response = await fetch(url);
            const data = await response.json();
            
            loader.style.display = 'none';
            resultsDiv.innerHTML = '';
            resultsDiv.style.display = 'block';

            if(data.foods.length === 0) {
                resultsDiv.innerHTML = '<div style="padding:10px;">No results found.</div>';
                return;
            }

            // Display results
            data.foods.forEach(food => {
                let div = document.createElement('div');
                div.className = 'result-item';
                div.innerText = food.description;
                div.onclick = function() {
                    selectFood(food.fdcId, food.description);
                };
                resultsDiv.appendChild(div);
            });

        } catch (error) {
            console.error(error);
            loader.innerText = "Error checking API Key.";
        }
    }

    // 2. GET DETAILS FUNCTION (When you click a food)
    async function selectFood(fdcId, name) {
        document.getElementById('searchResults').style.display = 'none';
        
        let weight = prompt(`How many grams of "${name}"?`, "100");
        weight = parseFloat(weight);
        if(!weight) return;

        // USDA Details Endpoint
        const url = `https://api.nal.usda.gov/fdc/v1/food/${fdcId}?api_key=${API_KEY}`;
        
        try {
            const response = await fetch(url);
            const data = await response.json();

            // USDA stores nutrients in a list with IDs. We need to find them.
            // Helper function to find nutrient by ID (Legacy or Modern)
            const getNutrient = (id) => {
                let n = data.foodNutrients.find(x => x.nutrient.number == id || x.nutrient.id == id);
                if (n && n.amount) {
                    return (n.amount * weight) / 100;
                }
                return 0;
            };

            // Retrieve Data (IDs are standard USDA nutrient numbers)
            // 208/1008=Kcal, 203/1003=Prot, 205/1005=Carb, 204/1004=Fat, 
            // 301/1087=Calcium, 303/1089=Iron, 401/1162=VitC, 304/1090=Mag, 306/1092=Pot
            mealPlan.push({
